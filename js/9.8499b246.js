(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"41ad":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-lg",attrs:{id:"adminnews"}},[a("div",{staticClass:"container"},[a("h5",{staticClass:"text-bold text-grey-9 q-mb-md"},[e._v("最新消息管理")]),a("q-btn",{staticClass:"bg-add q-mb-md",attrs:{unelevated:"","text-color":"white"},on:{click:function(t){e.editForm.isEdit=!0}}},[a("span",[a("q-icon",{attrs:{name:"add"}}),e._v(" 新增貼文")],1)]),a("q-table",{attrs:{data:e.table.data,columns:e.table.columns,"row-key":"name",pagination:e.table.pagination,flat:"",bordered:""},on:{"update:pagination":function(t){return e.$set(e.table,"pagination",t)}},scopedSlots:e._u([{key:"body-cell-description",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("p",{staticClass:"text-truncate"},[e._v(e._s(t.row.description))])])]}},{key:"body-cell-date",fn:function(t){return[a("q-td",{attrs:{props:t}},[e._v("\n          "+e._s(new Date(t.row.date).toLocaleDateString())+"\n        ")])]}},{key:"body-cell-post",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("div",[a("q-chip",{attrs:{"text-color":"white",square:"",color:e.options.post.find((function(e){return e.value===t.row.post})).color,label:e.options.post.find((function(e){return e.value===t.row.post})).label}})],1)])]}},{key:"body-cell-image1",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-avatar",{attrs:{size:"50px"}},[a("img",{attrs:{src:t.row.image1}})]),a("q-icon",{staticClass:"delfile cursor-pointer",attrs:{name:"close"},on:{click:function(a){return e.delFile(t.row)}}})],1)]}},{key:"body-cell-operation",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-btn",{staticClass:"bg-edit",attrs:{unelevated:""},on:{click:function(a){return e.editDialog(t.row)}}},[a("span",[e._v(" 編輯")])])],1)]}}])}),a("q-dialog",{attrs:{persistent:""},model:{value:e.editForm.isEdit,callback:function(t){e.$set(e.editForm,"isEdit",t)},expression:"editForm.isEdit"}},[a("q-card",{staticClass:"q-pa-lg",staticStyle:{"max-width":"500px",width:"100%"}},[e.editForm.model._id.length>0?a("h5",{staticClass:"text-center text-bold q-mb-lg"},[e._v("編輯貼文")]):a("h5",{staticClass:"text-center text-bold q-mb-lg"},[e._v("新增貼文")]),a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-12"},[a("q-input",{attrs:{label:"標題","stack-label":"",outlined:"",rules:[function(e){return!!e||"請輸入標題"}]},model:{value:e.editForm.model.title,callback:function(t){e.$set(e.editForm.model,"title",t)},expression:"editForm.model.title"}})],1),a("div",{staticClass:"col-12"},[a("q-input",{attrs:{type:"textarea",label:"說明","stack-label":"",outlined:""},model:{value:e.editForm.model.description,callback:function(t){e.$set(e.editForm.model,"description",t)},expression:"editForm.model.description"}})],1),a("div",{staticClass:"col-12"},[a("q-select",{attrs:{outlined:"",options:e.options.post,label:"狀態","emit-value":"","map-options":""},model:{value:e.editForm.model.post,callback:function(t){e.$set(e.editForm.model,"post",t)},expression:"editForm.model.post"}})],1),a("div",{staticClass:"col-12"},[a("q-input",{attrs:{filled:"",type:"date",hint:"發布時間"},model:{value:e.editForm.model.date,callback:function(t){e.$set(e.editForm.model,"date",t)},expression:"editForm.model.date"}})],1),a("div",{staticClass:"col-12"},[a("q-file",{attrs:{filled:"","bottom-slots":"",label:"上傳圖片",counter:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(e){e.stopPropagation()}}})]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(t){e.editForm.model.image1=null}}})]},proxy:!0},{key:"hint",fn:function(){return[e._v("\n                檔案大小\n              ")]},proxy:!0}]),model:{value:e.editForm.model.image1,callback:function(t){e.$set(e.editForm.model,"image1",t)},expression:"editForm.model.image1"}})],1),a("div",{staticClass:"col-6"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{unelevated:"",color:"primary",label:"送出"},on:{click:e.submitEdit}})],1),a("div",{staticClass:"col-6"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{unelevated:"",color:"grey-7",label:"取消"},on:{click:e.cancelEdit}})],1)])])],1)],1)])},i=[],n=a("c973"),r=a.n(n),s=(a("96cf"),a("99af"),a("d81d"),{name:"PageAdminNews",data:function(){return{editForm:{data:null,model:{title:"",description:"",date:"",post:!1,image1:null,_id:""},isEdit:!1},table:{pagination:{sortBy:"date",descending:!0,page:1,rowsPerPage:10},columns:[{name:"image1",field:"image1",align:"center",label:"圖片"},{name:"title",field:"title",align:"center",label:"標題",style:"width: 200px"},{name:"description",field:"description",align:"center",label:"說明",style:"width: 200px"},{name:"date",field:"date",align:"center",label:"上架時間",sortable:!0},{name:"post",field:"post",align:"center",label:"狀態"},{name:"operation",field:"operation",align:"center",label:"操作"}],data:[]},options:{post:[{label:"隱藏",value:!1,color:"grey-7"},{label:"發布",value:!0,color:"cyan-8"}]}}},methods:{editDialog:function(e){for(var t in this.editForm.isEdit=!0,e)this.editForm.model[t]=e[t];this.editForm.data=e},submitEdit:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){var a,o,i,n,r,s,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(o in t.prev=0,a=new FormData,e.editForm.model)a.append(o,e.editForm.model[o]);if(0!==e.editForm.model._id.length){t.next=12;break}return t.next=6,e.$axios.post("/news",a,{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 6:i=t.sent,n=i.data,e.table.data.push(e.editForm.model),e.editForm.model.image1="".concat("https://reuni-dessert.herokuapp.com","/files/").concat(n.result.image1),t.next=18;break;case 12:return t.next=14,e.$axios.patch("/news/"+e.editForm.model._id,a,{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 14:for(l in r=t.sent,s=r.data,e.editForm.model)e.editForm.data[l]=e.editForm.model[l];e.editForm.data.image1="".concat("https://reuni-dessert.herokuapp.com","/files/").concat(s.result.image1);case 18:e.editForm.model={title:"",description:"",date:"",post:!1,image1:null,_id:""},t.next=24;break;case 21:t.prev=21,t.t0=t["catch"](0),e.$q.notify({message:t.t0.response.data.message,timeout:1e3,type:"negative",color:"faded",textColor:"white",position:"top"});case 24:case"end":return t.stop()}}),t,null,[[0,21]])})))()},cancelEdit:function(){this.editForm.model={title:"",description:"",date:"",post:!1,image1:null,_id:""}},delFile:function(e){var t=this;return r()(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$axios.patch("/news/"+e._id+"/image1",{image1:""},{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 3:e.image1="",a.next=9;break;case 6:a.prev=6,a.t0=a["catch"](0),t.$q.notify({message:"刪除圖片失敗",timeout:1e3,type:"negative",color:"faded",textColor:"white",position:"top"});case 9:case"end":return a.stop()}}),a,null,[[0,6]])})))()}},mounted:function(){var e=this;return r()(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.get("/news/all",{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 3:a=t.sent,o=a.data,e.table.data=o.result.map((function(e){return e.image1&&(e.image1="".concat("https://reuni-dessert.herokuapp.com","/files/").concat(e.image1)),e})),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$q.notify({message:"取得資訊失敗",timeout:1e3,type:"negative",color:"faded",textColor:"white",position:"top"});case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()}}),l=s,d=a("2877"),c=a("9989"),u=a("9c40"),m=a("0016"),p=a("eaac"),f=a("db86"),g=a("b047"),b=a("cb32"),v=a("24e8"),h=a("f09f"),w=a("27f9"),x=a("ddd8"),k=a("7d53"),F=a("7f67"),q=a("eebe"),y=a.n(q),C=Object(d["a"])(l,o,i,!1,null,null,null);t["default"]=C.exports;y()(C,"components",{QPage:c["a"],QBtn:u["a"],QIcon:m["a"],QTable:p["a"],QTd:f["a"],QChip:g["a"],QAvatar:b["a"],QDialog:v["a"],QCard:h["a"],QInput:w["a"],QSelect:x["a"],QFile:k["a"]}),y()(C,"directives",{ClosePopup:F["a"]})}}]);