(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"41ad":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"q-pa-lg",attrs:{id:"adminnews"}},[a("div",{staticClass:"container"},[a("h5",{staticClass:"text-bold text-grey-9 q-mb-md"},[t._v("最新消息管理")]),a("q-btn",{staticClass:"bg-add q-mb-md",attrs:{unelevated:"","text-color":"white"},on:{click:function(e){t.editForm.isEdit=!0}}},[a("span",[a("q-icon",{attrs:{name:"add"}}),t._v(" 新增貼文")],1)]),a("q-table",{attrs:{data:t.table.data,columns:t.table.columns,"row-key":"name",pagination:t.table.pagination,flat:"",bordered:""},on:{"update:pagination":function(e){return t.$set(t.table,"pagination",e)}},scopedSlots:t._u([{key:"body-cell-description",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("p",{staticClass:"text-truncate"},[t._v(t._s(e.row.description))])])]}},{key:"body-cell-date",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(new Date(e.row.date).toLocaleDateString())+"\n        ")])]}},{key:"body-cell-post",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("div",[a("q-chip",{attrs:{"text-color":"white",square:"",color:t.options.post.find((function(t){return t.value===e.row.post})).color,label:t.options.post.find((function(t){return t.value===e.row.post})).label}})],1)])]}},{key:"body-cell-image11",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-avatar",{attrs:{size:"50px"}},[a("img",{attrs:{src:t.row.image11}})])],1)]}},{key:"body-cell-operation",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("q-btn",{staticClass:"bg-edit",attrs:{unelevated:""},on:{click:function(a){return t.editDialog(e.row)}}},[a("span",[t._v(" 編輯")])])],1)]}}])}),a("q-dialog",{attrs:{persistent:""},model:{value:t.editForm.isEdit,callback:function(e){t.$set(t.editForm,"isEdit",e)},expression:"editForm.isEdit"}},[a("q-card",{staticClass:"q-pa-lg",staticStyle:{"max-width":"500px",width:"100%"}},[t.editForm.model._id.length>0?a("h5",{staticClass:"text-center text-bold q-mb-lg"},[t._v("編輯貼文")]):a("h5",{staticClass:"text-center text-bold q-mb-lg"},[t._v("新增貼文")]),a("div",{staticClass:"row q-col-gutter-md"},[a("div",{staticClass:"col-12"},[a("q-input",{attrs:{label:"標題","stack-label":"",outlined:"",rules:[function(t){return!!t||"請輸入標題"}]},model:{value:t.editForm.model.title,callback:function(e){t.$set(t.editForm.model,"title",e)},expression:"editForm.model.title"}})],1),a("div",{staticClass:"col-12"},[a("q-input",{attrs:{type:"textarea",label:"說明","stack-label":"",outlined:""},model:{value:t.editForm.model.description,callback:function(e){t.$set(t.editForm.model,"description",e)},expression:"editForm.model.description"}})],1),a("div",{staticClass:"col-12"},[a("q-select",{attrs:{outlined:"",options:t.options.post,label:"狀態","emit-value":"","map-options":""},model:{value:t.editForm.model.post,callback:function(e){t.$set(t.editForm.model,"post",e)},expression:"editForm.model.post"}})],1),a("div",{staticClass:"col-12"},[a("q-input",{attrs:{filled:"",type:"date",hint:"發布時間"},model:{value:t.editForm.model.date,callback:function(e){t.$set(t.editForm.model,"date",e)},expression:"editForm.model.date"}})],1),a("div",{staticClass:"col-12"},[a("q-file",{attrs:{filled:"","bottom-slots":"",label:"上傳圖片",counter:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){t.editForm.model.image1=null}}})]},proxy:!0},{key:"hint",fn:function(){return[t._v("\n                檔案大小\n              ")]},proxy:!0}]),model:{value:t.editForm.model.image1,callback:function(e){t.$set(t.editForm.model,"image1",e)},expression:"editForm.model.image1"}})],1),a("div",{staticClass:"col-6"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{unelevated:"",color:"primary",label:"送出"},on:{click:t.submitEdit}})],1),a("div",{staticClass:"col-6"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{unelevated:"",color:"grey-7",label:"取消"},on:{click:t.cancelEdit}})],1)])])],1)],1)])},i=[],n=a("ded3"),r=a.n(n),s=a("c973"),l=a.n(s),d=(a("96cf"),a("99af"),a("d81d"),{name:"PageAdminNews",data:function(){return{editForm:{data:null,model:{title:"",description:"",date:"",post:!1,image1:null,_id:""},isEdit:!1},table:{pagination:{sortBy:"date",descending:!0,page:1,rowsPerPage:10},columns:[{name:"image11",field:"image11",align:"center",label:"圖片"},{name:"title",field:"title",align:"center",label:"標題",style:"width: 200px"},{name:"description",field:"description",align:"center",label:"說明",style:"width: 200px"},{name:"date",field:"date",align:"center",label:"上架時間",sortable:!0},{name:"post",field:"post",align:"center",label:"狀態"},{name:"operation",field:"operation",align:"center",label:"操作"}],data:[]},options:{post:[{label:"隱藏",value:!1,color:"grey-7"},{label:"發布",value:!0,color:"cyan-8"}]}}},methods:{editDialog:function(t){for(var e in this.editForm.isEdit=!0,t)this.editForm.model[e]=t[e];this.editForm.data=t},submitEdit:function(){var t=this;return l()(regeneratorRuntime.mark((function e(){var a,o,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(o in e.prev=0,a=new FormData,t.editForm.model)a.append(o,t.editForm.model[o]);if(0!==t.editForm.model._id.length){e.next=8;break}return e.next=6,t.$axios.post("/news",a,{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}}).then((function(e){t.editForm.model._id=e.data.result._id,t.table.data.push(r()(r()({},t.editForm.model),{},{image11:"".concat("https://reuni-dessert.herokuapp.com","/files/").concat(e.data.result.image1)}))}));case 6:e.next=14;break;case 8:return e.next=10,t.$axios.patch("/news/"+t.editForm.model._id,a,{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 10:for(s in i=e.sent,n=i.data,t.editForm.model)t.editForm.data[s]=t.editForm.model[s];t.editForm.data.image11="".concat("https://reuni-dessert.herokuapp.com","/files/").concat(n.result.image1);case 14:t.editForm.model={title:"",description:"",date:"",post:!1,image1:null,_id:""},e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](0),t.$q.notify({message:e.t0.response.data.message,timeout:1e3,type:"negative",color:"faded",textColor:"white",position:"top"});case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))()},cancelEdit:function(){this.editForm.model={title:"",description:"",date:"",post:!1,image1:null,_id:""}}},mounted:function(){var t=this;return l()(regeneratorRuntime.mark((function e(){var a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/news/all",{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 3:a=e.sent,o=a.data,t.table.data=o.result.map((function(t){return t.image1&&(t.image11="".concat("https://reuni-dessert.herokuapp.com","/files/").concat(t.image1)),t})),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$q.notify({message:"取得資訊失敗",timeout:1e3,type:"negative",color:"faded",textColor:"white",position:"top"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}),c=d,m=a("2877"),p=a("9989"),u=a("9c40"),f=a("0016"),b=a("eaac"),g=a("db86"),v=a("b047"),h=a("cb32"),w=a("24e8"),x=a("f09f"),F=a("27f9"),k=a("ddd8"),q=a("7d53"),y=a("7f67"),C=a("eebe"),_=a.n(C),$=Object(m["a"])(c,o,i,!1,null,null,null);e["default"]=$.exports;_()($,"components",{QPage:p["a"],QBtn:u["a"],QIcon:f["a"],QTable:b["a"],QTd:g["a"],QChip:v["a"],QAvatar:h["a"],QDialog:w["a"],QCard:x["a"],QInput:F["a"],QSelect:k["a"],QFile:q["a"]}),_()($,"directives",{ClosePopup:y["a"]})}}]);